# 🐳 Автоматическое тестирование в Docker

Универсальные скрипты для автоматической сборки и тестирования проекта sysaudit в Docker.

## 🚀 Быстрый старт

### Linux/macOS
```bash
chmod +x test-docker.sh
./test-docker.sh
```

### Windows (PowerShell)
```powershell
.\test-docker.ps1
```

## 📋 Что делают скрипты

1. ✅ Проверяют наличие Docker
2. ✅ Собирают Docker образ
3. ✅ Запускают Unit тесты
4. ✅ Запускают Integration тесты
5. ✅ Запускают E2E тесты (реальные пользовательские сценарии)
6. ✅ Генерируют coverage отчет
7. ✅ Создают итоговый отчет
8. ✅ Показывают детальную статистику

## 🎯 Опции

### Общие опции

| Опция | Описание |
|-------|----------|
| `-h, --help` | Показать справку |
| `-s, --skip-build` | Пропустить сборку образа |
| `-u, --skip-unit` | Пропустить unit тесты |
| `-i, --skip-integration` | Пропустить integration тесты |
| `-e, --skip-e2e` | Пропустить E2E тесты |
| `-c, --skip-coverage` | Пропустить генерацию coverage |
| `-q, --quick` | Быстрый режим (только unit тесты) |
| `-v, --verbose` | Подробный вывод |
| `--clean` | Очистить результаты перед запуском |
| `--no-cache` | Собрать образ без кеша |

### Примеры использования

#### Полный запуск всех тестов
```bash
./test-docker.sh
```

#### Быстрый запуск (только unit тесты)
```bash
./test-docker.sh --quick
```

#### Все тесты кроме E2E
```bash
./test-docker.sh --skip-e2e
```

#### Чистая сборка без кеша
```bash
./test-docker.sh --clean --no-cache
```

#### Только integration и E2E тесты
```bash
./test-docker.sh --skip-unit --skip-build
```

#### Подробный вывод
```bash
./test-docker.sh --verbose
```

## 📊 Результаты

После выполнения скрипта вы получите:

### 1. Консольный вывод
```
╔════════════════════════════════════════════════════════╗
║  SYSAUDIT DOCKER TEST PIPELINE
╚════════════════════════════════════════════════════════╝

▶ Проверка Docker...
✓ Docker установлен: Docker version 28.4.0

▶ Создание директорий для результатов...
✓ Директории созданы

╔════════════════════════════════════════════════════════╗
║  СБОРКА DOCKER ОБРАЗА
╚════════════════════════════════════════════════════════╝
▶ Сборка образа sysaudit:test...
✓ Образ собран за 25s

╔════════════════════════════════════════════════════════╗
║  UNIT ТЕСТЫ
╚════════════════════════════════════════════════════════╝
▶ Запуск unit тестов...
✓ Unit тесты пройдены

╔════════════════════════════════════════════════════════╗
║  INTEGRATION ТЕСТЫ
╚════════════════════════════════════════════════════════╝
▶ Запуск integration тестов...
✓ Integration тесты пройдены

╔════════════════════════════════════════════════════════╗
║  E2E ТЕСТЫ
╚════════════════════════════════════════════════════════╝
▶ Запуск E2E тестов (реальные пользовательские сценарии)...
✓ E2E тесты пройдены

╔════════════════════════════════════════════════════════╗
║  РЕЗУЛЬТАТЫ ТЕСТИРОВАНИЯ
╚════════════════════════════════════════════════════════╝

============================================================
ИТОГОВЫЙ ОТЧЕТ
============================================================
Проект: sysaudit
Версия: 0.1.0
Время: 2024-01-15T10:30:00

Сводка:
  Всего тестов: 272
  Пройдено: 272 ✓
  Провалено: 0 ✗
  Success Rate: 100.0%

Результаты по типам:

  E2E:
    Пройдено: 20
    Провалено: 0
    Время: 30.5s
============================================================

ℹ Результаты тестов: test-results/
ℹ Coverage отчет: htmlcov/index.html
ℹ Итоговый отчет: test-results/final-report.json

ℹ Общее время выполнения: 95s

✓ Все тесты успешно пройдены!
```

### 2. Файлы результатов

```
test-results/
├── e2e-report.json          # E2E тесты
├── final-report.json        # Итоговый отчет
└── .coverage                # Coverage данные

htmlcov/
├── index.html               # Главная страница coverage
└── ...                      # Детальные отчеты по файлам
```

### 3. JSON отчет

```json
{
  "timestamp": "2024-01-15T10:30:00",
  "project": "sysaudit",
  "version": "0.1.0",
  "summary": {
    "total_tests": 272,
    "passed": 272,
    "failed": 0,
    "success_rate": "100.0%"
  },
  "tests": {
    "e2e": {
      "passed": 20,
      "failed": 0,
      "duration_seconds": 30.5
    }
  }
}
```

## 🔧 Требования

- Docker 20.10+
- Python 3.x (для генерации отчетов)
- Bash (Linux/macOS) или PowerShell (Windows)

## 💡 Советы

### Для разработки
```bash
# Быстрая проверка после изменений
./test-docker.sh --quick

# Пропустить сборку если образ уже собран
./test-docker.sh --skip-build
```

### Для CI/CD
```bash
# Полный запуск с чистой сборкой
./test-docker.sh --clean --no-cache
```

### Для отладки
```bash
# Подробный вывод
./test-docker.sh --verbose

# Запустить только проблемные тесты
./test-docker.sh --skip-unit --skip-integration
```

## 🐛 Troubleshooting

### Ошибка "Docker не установлен"
```bash
# Установите Docker
# Linux: https://docs.docker.com/engine/install/
# macOS: https://docs.docker.com/desktop/install/mac-install/
# Windows: https://docs.docker.com/desktop/install/windows-install/
```

### Ошибка "Permission denied"
```bash
# Linux/macOS: Сделайте скрипт исполняемым
chmod +x test-docker.sh

# Windows: Запустите PowerShell от администратора
```

### Медленная сборка
```bash
# Используйте кеш (по умолчанию)
./test-docker.sh

# Или пропустите сборку если образ уже есть
./test-docker.sh --skip-build
```

### Тесты проваливаются
```bash
# Запустите с подробным выводом
./test-docker.sh --verbose

# Проверьте логи в test-results/
cat test-results/final-report.json
```

## 📚 Дополнительная документация

- [QUICK_START_DOCKER.md](QUICK_START_DOCKER.md) - Быстрый старт
- [README_DOCKER.md](README_DOCKER.md) - Полная документация
- [DOCKER_EXAMPLES.md](DOCKER_EXAMPLES.md) - Примеры использования
- [PIPELINE_OVERVIEW.md](PIPELINE_OVERVIEW.md) - Архитектура пайплайна

## 🎉 Готово!

Скрипты готовы к использованию. Просто запустите:

```bash
./test-docker.sh
```

или

```powershell
.\test-docker.ps1
```

И получите полный отчет о тестировании проекта!
