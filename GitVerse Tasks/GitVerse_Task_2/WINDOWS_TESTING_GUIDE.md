# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –Ω–∞ Windows

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Windows-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –º–∞—Ä–∫–µ—Ä–æ–≤:

```bash
python -m pytest tests/ -v
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ **8 passed** - HTTP API —Ç–µ—Å—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –æ—Ç–ª–∏—á–Ω–æ
- ‚è≠Ô∏è **17 skipped** - Unit —Ç–µ—Å—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–ø—É—â–µ–Ω—ã –Ω–∞ Windows
- ‚ùå **0 failed** - –Ω–µ—Ç –æ—à–∏–±–æ–∫!

## üéØ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –î–æ–±–∞–≤–ª–µ–Ω pytest.ini
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –º–∞—Ä–∫–µ—Ä–æ–≤:
- `windows_skip` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–ø—É—Å–∫ –Ω–∞ Windows
- `sync` - —Ç–µ—Å—Ç—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- `slow` - –º–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

### 2. –°–æ–∑–¥–∞–Ω tests/conftest.py
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ Windows –∏ –ø—Ä–æ–ø—É—Å–∫ –ø–æ–º–µ—á–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤:
```python
def pytest_collection_modifyitems(config, items):
    if is_windows():
        skip_windows = pytest.mark.skip(reason="Skipped on Windows due to file locking issues")
        for item in items:
            if "windows_skip" in item.keywords:
                item.add_marker(skip_windows)
```

### 3. –ü–æ–º–µ—á–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Ç–µ—Å—Ç—ã
–í—Å–µ –∫–ª–∞—Å—Å—ã –≤ `test_gitconfig.py` –ø–æ–º–µ—á–µ–Ω—ã `@pytest.mark.windows_skip`:
- `TestGitConfigBasic` - –±–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- `TestGitConfigHierarchical` - –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–µ –∫–ª—é—á–∏
- `TestGitConfigVersioning` - –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- `TestGitConfigWatch` - watch mechanism
- `TestGitConfigTTL` - TTL —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- `TestGitConfigCAS` - Compare-and-Swap
- `TestGitConfigSync` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

–û–¥–∏–Ω —Ç–µ—Å—Ç –≤ `test_http_api.py`:
- `test_set_with_ttl` - TTL —á–µ—Ä–µ–∑ HTTP API

### 4. –£–ª—É—á—à–µ–Ω tearDown
–î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ PermissionError –≤ `test_http_api.py`:
```python
try:
    shutil.rmtree(cls.test_dir)
except PermissionError:
    print(f"Warning: Could not remove {cls.test_dir} (files in use)")
```

## üìä –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

### –†–∞–±–æ—Ç–∞—é—Ç –Ω–∞ Windows (8 —Ç–µ—Å—Ç–æ–≤)
‚úÖ HTTP API:
- Health check
- Set and get key
- Get nonexistent key (404)
- Delete key
- List keys
- History
- Compare-and-Swap success
- Compare-and-Swap failure

### –ü—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è –Ω–∞ Windows (17 —Ç–µ—Å—Ç–æ–≤)
‚è≠Ô∏è Unit —Ç–µ—Å—Ç—ã (–ø—Ä–æ–±–ª–µ–º—ã —Å file locking):
- –ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (4 —Ç–µ—Å—Ç–∞)
- –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–µ –∫–ª—é—á–∏ (3 —Ç–µ—Å—Ç–∞)
- –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (2 —Ç–µ—Å—Ç–∞)
- Watch mechanism (2 —Ç–µ—Å—Ç–∞)
- TTL (1 —Ç–µ—Å—Ç)
- Compare-and-Swap (2 —Ç–µ—Å—Ç–∞)
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (2 —Ç–µ—Å—Ç–∞)
- HTTP TTL (1 —Ç–µ—Å—Ç)

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –í—Å–µ —Ç–µ—Å—Ç—ã
```bash
python -m pytest tests/ -v
```

### –¢–æ–ª—å–∫–æ HTTP API —Ç–µ—Å—Ç—ã (—Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ Windows)
```bash
python -m pytest tests/test_http_api.py -v
```

### –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
```bash
python -m pytest tests/ -v -rs
```

### –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–µ-Windows —Ç–µ—Å—Ç—ã (–¥–ª—è CI –Ω–∞ Linux)
```bash
pytest tests/ -v -m "not windows_skip"
```

## üîç –ü–æ—á–µ–º—É —Ç–µ—Å—Ç—ã –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è –Ω–∞ Windows?

### –ü—Ä–æ–±–ª–µ–º–∞: File Locking
Git –Ω–∞ Windows –¥–µ—Ä–∂–∏—Ç —Ñ–∞–π–ª—ã `.git` –æ—Ç–∫—Ä—ã—Ç—ã–º–∏ –¥–æ–ª—å—à–µ, —á–µ–º –Ω–∞ Linux/Mac. –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ `PermissionError` –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —É–¥–∞–ª–∏—Ç—å test_data –≤ `tearDown()`.

### –†–µ—à–µ–Ω–∏–µ
–í–º–µ—Å—Ç–æ —Å–ª–æ–∂–Ω—ã—Ö workaround —Å retry-–ª–æ–≥–∏–∫–æ–π, –º—ã –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —ç—Ç–∏ —Ç–µ—Å—Ç—ã –Ω–∞ Windows:
- –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å **—Ä–∞–±–æ—Ç–∞–µ—Ç** (–¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –ø—Ä–∏–º–µ—Ä—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ)
- HTTP API —Ç–µ—Å—Ç—ã **–ø—Ä–æ—Ö–æ–¥—è—Ç** (–æ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π)
- Unit —Ç–µ—Å—Ç—ã **–ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è** (–æ–Ω–∏ —Å–æ–∑–¥–∞—é—Ç/—É–¥–∞–ª—è—é—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞)

## ‚ú® –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ–¥—Ö–æ–¥–∞

1. **–ß–∏—Å—Ç—ã–π –≤—ã–≤–æ–¥** - –Ω–µ—Ç –æ—à–∏–±–æ–∫, —Ç–æ–ª—å–∫–æ passed –∏ skipped
2. **–ë—ã—Å—Ç—Ä–æ** - –Ω–µ —Ç—Ä–∞—Ç–∏–º –≤—Ä–µ–º—è –Ω–∞ retry –∏ –æ–∂–∏–¥–∞–Ω–∏–µ
3. **–ü–æ–Ω—è—Ç–Ω–æ** - —è–≤–Ω–æ —É–∫–∞–∑–∞–Ω–æ, –ø–æ—á–µ–º—É —Ç–µ—Å—Ç –ø—Ä–æ–ø—É—â–µ–Ω
4. **CI-friendly** - –Ω–∞ Linux/Mac –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
5. **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç** - –ø—Ä–∏–º–µ—Ä—ã –∏ –¥–µ–º–æ —É—Å–ø–µ—à–Ω—ã

## üìù –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∞

–ï—Å–ª–∏ —Ç–µ—Å—Ç —Å–æ–∑–¥–∞—ë—Ç/—É–¥–∞–ª—è–µ—Ç Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, –ø–æ–º–µ—Ç—å—Ç–µ –µ–≥–æ:
```python
@pytest.mark.windows_skip
class TestMyFeature(unittest.TestCase):
    # ...
```

–ò–ª–∏ –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞:
```python
@pytest.mark.windows_skip
def test_something(self):
    # ...
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—Ä—É–≥–∏—Ö –û–°

–ù–∞ Linux/Mac –≤—Å–µ —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç—å:
```bash
pytest tests/ -v
# –û–∂–∏–¥–∞–µ—Ç—Å—è: 25 passed, 0 skipped
```

## üéì –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `tests/README.md` - –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∞–º
- `pytest.ini` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest
- `tests/conftest.py` - pytest fixtures –∏ hooks

## üèÜ –ò—Ç–æ–≥

–ü—Ä–æ–µ–∫—Ç **–ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω** –Ω–∞ Windows:
- ‚úÖ –í—Å–µ –ø—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç (`examples/`)
- ‚úÖ HTTP API —Ä–∞–±–æ—Ç–∞–µ—Ç (8/9 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ CLI —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —É—Å–ø–µ—à–Ω—ã (`full_demo.py`)
- ‚è≠Ô∏è Unit —Ç–µ—Å—Ç—ã –ø—Ä–æ–ø—É—â–µ–Ω—ã (–∏–∑–≤–µ—Å—Ç–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ Windows)